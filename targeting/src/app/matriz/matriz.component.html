<!--<ejs-pivotview #pivotview id='PivotView' height='350' [dataSourceSettings]=dataSourceSettings></ejs-pivotview>-->
<h1>Matriz de {{state.nombre}}</h1>
<hr>

<div *ngIf="loading; else notShow">
  <h4>LOADING</h4>
</div>
<ng-template #notShow>
<div class="table-wrapper">
<div align="right">
  <button mat-icon-button color="success"(click)="refresh()">
      <mat-icon>refresh</mat-icon>
  </button>
  <p-toast position="top-center"></p-toast>
  <button mat-icon-button color="success" (click)="saveEstado()">
    <mat-icon>save</mat-icon>
  </button>
</div>
<table class="fl-table">
  <thead>
    <tr>
      <th>
        <div class="center">
          Actores/Temas
        </div>
      </th>
      <th *ngFor="let item of Matriz.Temas">
        {{item.name}}
        <div *ngFor="let hijo of item.hijos">
          {{hijo.name}}
          <div *ngFor="let subhijo of hijo.hijos">
            {{subhijo.name}}
            <div *ngFor="let subhijo2 of subhijo.hijos">
              {{subhijo2.name}}
            </div>
          </div>
        </div>
      </th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let actor of Matriz.Actores">
      <th>
        <span class='empty_fill'>{{actor.name}}
           <span  *ngFor="let hijo of actor.hijos">
            <ul>
              {{hijo.name}}
            <ul>
              <span *ngFor="let subhijo of hijo.hijos">
                {{subhijo.name}}
                <ul>
                  <span  *ngFor="let subhijo2 of subhijo.hijos">
                      <li>
                        {{subhijo2.name}}
                      </li>
                  </span>  
                </ul> 
              </span>
            </ul>
            </ul> 
           </span>  
         </span> 
      </th>
      <td *ngFor="let tema of Matriz.Temas">
          <div *ngFor = "let cell of Matriz.Celdas">
              <div *ngIf = "actor.id == cell.ActorParent.id && tema.id == cell.TemaParent.id">
                <mat-button-toggle-group #group="matButtonToggleGroup" value="{{cell.prioridad}}">
                  <mat-button-toggle value="0" (change)="onPrioridadChange($event.value,tema.id,actor.id,cell.id)" aria-label="Text align left">
                    N/A
                  </mat-button-toggle>
                  <mat-button-toggle value="1" (change)="onPrioridadChange($event.value,tema.id,actor.id,cell.id)" aria-label="Text align left">
                    <mat-icon class="green-icon">fiber_manual_record</mat-icon>
                  </mat-button-toggle>
                  <mat-button-toggle value="2" (change)="onPrioridadChange($event.value,tema.id,actor.id,cell.id)" aria-label="Text align center">
                    <mat-icon class="yellow-icon">fiber_manual_record</mat-icon>
                  </mat-button-toggle>
                  <mat-button-toggle value="3" (change)="onPrioridadChange($event.value,tema.id,actor.id,cell.id)" aria-label="Text align right">
                    <mat-icon class="red-icon">fiber_manual_record</mat-icon>
                  </mat-button-toggle>
                </mat-button-toggle-group>
                <br>
                <mat-button-toggle-group #grouptime="matButtonToggleGroup" value="{{cell.tiempo}}">
                  <mat-button-toggle value="0" (change)="onTimeChange($event.value,tema.id,actor.id,cell.id)" aria-label="Text align left">
                    N/A
                  </mat-button-toggle>
                  <mat-button-toggle value="1" (change)="onTimeChange($event.value,tema.id,actor.id,cell.id)" aria-label="Text align left">
                    <img src="assets/img/courtblack.gif" />
                  </mat-button-toggle>
                  <mat-button-toggle value="2" (change)="onTimeChange($event.value,tema.id,actor.id,cell.id)" aria-label="Text align center">
                    <img src="assets/img/moyenblack.gif" />
                  </mat-button-toggle>
                  <mat-button-toggle value="3" (change)="onTimeChange($event.value,tema.id,actor.id,cell.id)" aria-label="Text align right">
                    <img src="assets/img/longblack.gif" />    
                  </mat-button-toggle>
                </mat-button-toggle-group>
              </div>
          </div>
      </td>
    </tr>
  </tbody>
</table>

<mat-button-toggle-group #grouptime="matButtonToggleGroup">
  <mat-button-toggle value="Bajo" aria-label="Text align left">
    <img src="assets/img/courtblack.gif" />
  </mat-button-toggle>
  <mat-button-toggle value="Medio" aria-label="Text align center">
    <img src="assets/img/moyenblack.gif" />
  </mat-button-toggle>
  <mat-button-toggle value="Alto" aria-label="Text align right">
    <img src="assets/img/longblack.gif" />    
  </mat-button-toggle>
</mat-button-toggle-group>
<span class="center" style="padding-right: 20px;">Tiempo: {{grouptime.value}}</span>
<mat-button-toggle-group #group="matButtonToggleGroup">
  <mat-button-toggle value="Baja" aria-label="Text align left">
    <mat-icon class="green-icon">fiber_manual_record</mat-icon>
  </mat-button-toggle>
  <mat-button-toggle value="Media" aria-label="Text align center">
    <mat-icon class="yellow-icon">fiber_manual_record</mat-icon>
  </mat-button-toggle>
  <mat-button-toggle value="Alta" aria-label="Text align right">
    <mat-icon class="red-icon">fiber_manual_record</mat-icon>
  </mat-button-toggle>
</mat-button-toggle-group>
<span class="center">Prioridad: {{group.value}}</span>
</div>
<h1>TEST</h1>
<button mat-icon-button color="success" (click)="contador()">
  <mat-icon>save</mat-icon>
  TEST
</button>

<table class="fl-table">
  <thead>
    <tr>
      <th rowspan="4" colspan="4">
        <div class="center">
          Actores/Temas
        </div>
      </th>
    <ng-container *ngFor="let item of Matriz.Temas; let i = index">
      <ng-container *ngIf = "item.hijos?.length; else padre">
        <th [attr.colspan]="maxcolspan(item)">{{item.name}} {{maxcolspan(item)}}</th>
      </ng-container>
      <ng-template #padre>
        <th rowspan="4">{{item.name}}</th>
      </ng-template>
    </ng-container>
    </tr>
    <tr>
    <ng-container *ngFor="let item of Matriz.Temas" >
      <ng-container *ngIf = "item.hijos?.length">
        <ng-container *ngFor="let hijo of item.hijos">
        <ng-container *ngIf = "hijo.hijos?.length == 0; else subhijo">
          <th rowspan="3">{{hijo.name}} </th>
        </ng-container>
        <ng-template #subhijo>
          <th [attr.colspan]="maxcolspan(item)  ">{{hijo.name}} {{hijo.hijos?.length}}</th>
        </ng-template>
        </ng-container>     
      </ng-container>
    </ng-container>
   </tr>
   <tr>
    <ng-container *ngFor="let item of Matriz.Temas" >
      <ng-container *ngIf = "item.hijos?.length">
        <ng-container *ngFor="let hijo of item.hijos">
          <ng-container *ngFor="let subhijo of hijo.hijos">
          <ng-container *ngIf = "subhijo.hijos?.length == 0; else subhijo1">
            <th rowspan="2">{{subhijo.name}}</th>
          </ng-container>
          <ng-template #subhijo1>
            <th [attr.colspan]="maxcolspan(item)">{{subhijo.name}}</th>
          </ng-template>
          </ng-container>
        </ng-container>     
      </ng-container>
    </ng-container>
   </tr>
   <tr>
    <ng-container *ngFor="let item of Matriz.Temas" >
      <ng-container *ngIf = "item.hijos?.length">
        <ng-container *ngFor="let hijo of item.hijos">
          <ng-container *ngFor="let subhijo of hijo.hijos">
          <ng-container *ngFor = "let subhijo2 of subhijo.hijos">
            <th>{{subhijo2.name}}</th>
          </ng-container>
          </ng-container>
        </ng-container>     
      </ng-container>
    </ng-container>
   </tr>
  </thead>
  <tbody *ngFor="let item of Matriz.Actores; let i = index">
    <ng-container *ngIf = "item.hijos?.length; else padre">
      <tr>
        <th [attr.rowspan]="maxrowspan(item)">{{item.name}}</th>
        <ng-container *ngIf = "item.hijos[0].hijos?.length; else subhijoCabezera">
          <th [attr.rowspan]="maxrowspan(item)"> {{item.hijos[0].name}}</th>
          <ng-container *ngIf = "item.hijos[0].hijos[0].hijos?.length; else subsubhijoCabezera">
            <th [attr.rowspan]="item.hijos[0].hijos[0].hijos?.length"> {{item.hijos[0].hijos[0].name}}</th>
            <th>{{item.hijos[0].hijos[0].hijos[0].name}}</th>
          </ng-container>
        </ng-container>
      </tr>
      <ng-container *ngFor="let hijo of item.hijos; let a = index">
        <ng-container *ngIf = "a != 0">
          <ng-container *ngIf = "hijo.hijos?.length; else subhijoBody">
            <tr>
              <th [attr.rowspan]="maxrowspan(item)-1">{{hijo.name}}</th>
              <ng-container *ngIf = "hijo.hijos[0].hijos.length; else ultimo">
                <th [attr.rowspan]="hijo.hijos[0].hijos.length">{{hijo.hijos[0].name}}</th>
                <th>{{hijo.hijos[0].hijos[0].name}} </th>
              </ng-container>
            </tr>
            <ng-template #ultimo>
              <th colspan="2">{{hijo.hijos[0].name}}</th>
            </ng-template>
          </ng-container>
        </ng-container>
        <ng-container *ngFor="let subhijo of hijo.hijos; let b = index">
            <ng-container *ngIf = "b != 0; else Prueba">
              <ng-container *ngIf = "subhijo.hijos?.length; else subsubhijoBody">
                <tr>
                  <th [attr.rowspan]="subhijo.hijos?.length" >{{subhijo.name}} </th>
                  <th>{{subhijo.hijos[0].name}}</th>
                </tr>
                <ng-container *ngFor = "let subhijo1 of subhijo.hijos; let c = index">
                  <ng-container *ngIf = "c != 0;">
                    <tr>
                      <th>{{subhijo1.name}}</th>
                    </tr>
                  </ng-container>
                </ng-container>
              </ng-container>
          </ng-container>
          <ng-template #subsubhijoBody>
            <tr>
              <th colspan="2">{{subhijo.name}}</th>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </ng-template>
          <ng-template #Prueba>
            <ng-container *ngIf="subhijo.hijos?.length >1">
              <ng-container *ngFor = "let subhijo1 of subhijo.hijos; let c = index">
                <ng-container *ngIf = "c != 0">
                  <th>{{subhijo1.name}}</th>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                  <td></td>
                </ng-container>
              </ng-container>
            </ng-container>
          </ng-template>
        </ng-container>
        <ng-template #subhijoBody>
          <tr>
            <th colspan="3"> {{hijo.name}}</th>
            <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
          </tr>  
        </ng-template>
      </ng-container>
    </ng-container>
    <ng-template #subhijoCabezera>
      <th colspan="3"> {{item.hijos[0].name}}</th>
      <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
    </ng-template>
    <ng-template #subsubhijoCabezera>
      <th colspan="2"> {{item.hijos[0].hijos[0].name}}</th>
      <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
    </ng-template>
    <ng-template #padre>
      <tr>
        <th colspan="4">
          {{item.name}}
        </th>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
    </ng-template>
  </tbody>
  <!--<tbody>

    <ng-container *ngFor="let item of Matriz.Actores; let i = index">
        <ng-container *ngIf = "item.hijos?.length; else padre">
          <tr>
            <th [attr.rowspan]="maxcolspan(item)">{{item.name}} {{maxcolspan(item)}}</th>
            <th> {{item.hijos[0].name}}</th>
          </tr>
          <ng-container *ngFor = "let subhijo of item.hijos">
            <ng-container *ngIf = "subhijo.hijos?.length; else subhijo">

            </ng-container>
          </ng-container>
          <ng-template #subhijo>
            <tr>
              <th [attr.rowspan]="maxcolspan(item)">{{item.name}} {{maxcolspan(item)}}</th>
              <th> {{item.hijos[0].name}}</th>
            </tr>
            <ng-container *ngFor="let hijo of item.hijos| slice:1">
              <tr>
                <th>{{hijo.name}}</th>
              </tr>  
            </ng-container>
          </ng-template>
        </ng-container>
        <ng-template #padre>
          <tr>
            <th colspan="4">{{item.name}}</th>
          </tr>
        </ng-template>
    </ng-container>
  </tbody>-->
</table>

<h1>TEST 2</h1>
<table class="fl-table">
  <thead>
    <tr>
      <th rowspan="4" colspan="4">
        <div class="center">
          Actores/Temas
        </div>
      </th>
      <th colspan="2">Tema 1</th>
      <th colspan="2">Tema 2</th>
      <th colspan="2">Tema 3</th>
      <th rowspan="4">Tema 4</th>
    </tr>
    <tr>
      <th rowspan="3"> Sub Tema 1_1</th>
      <th rowspan="3"> Sub Tema 1_2</th>
      <th colspan="2"> Sub Tema 2_1</th>
      <th colspan="2"> Sub Tema 3_1</th>
   </tr>
   <tr>
    <th colspan="2">SubT Tema 2_1_1</th>
    <th rowspan="2">SubT Tema 3_1_1</th>
    <th rowspan="3">SubT Tema 3_1_2</th>
   </tr>
   <tr>
     <th>Sub Tema 2_1_1_1</th>
     <th>Sub Tema 2_1_1_2</th>
   </tr>
  </thead>
  <tbody>
    <tr>
      <th colspan="4">Actor 2</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th colspan="4">Actor 3</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th colspan="4">Actor 4</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="3">Actor 1</th>
      <th>Actor 1_1</th>
      <th>Actor 1_1_1</th>
      <th>Actor 1_1_1_1</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th rowspan="2">Actor 1_2</th>
      <th colspan="2">Actor 1_2_1</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
    <tr>
      <th colspan="2">Actor 1_2_2</th>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
      <td></td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <th rowspan="5">Actor 5</th>
    </tr>
    <tr>
      <th rowspan="4">Actor 5_2</th>
      <th rowspan="2">Actor 5_2_1</th>
      <th>Actor 5_2_1_1</th>
    </tr>
    <tr>
      <th>Actor 5_2_1_2</th>
    </tr>
    
    <tr>
      <th rowspan="2">Actor 5_2_2</th>
      <th>Actor 5_2_2_1</th>
    </tr>
    <tr>
      <th>Actor 5_2_2_2</th>
    </tr>
   
  </tbody>
</table>
</ng-template>


